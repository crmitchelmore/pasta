# Pasta - Clipboard History Progress Log

## Project Started
Date: 2026-01-19

---

## 2026-01-19
- Implemented core `ClipboardEntry` model (with `ContentType` + `CodeLanguage`) in PastaCore
- Added Codable round-trip unit test for `ClipboardEntry`
- Marked PRD item "Create core data model for clipboard entries" as complete
- Added `DatabaseManager` (GRDB) with migrations + CRUD/search APIs
- Added in-memory database factory for tests
- Added unit tests for DatabaseManager CRUD and ordering
- Marked PRD item "Set up SQLite database with GRDB for local storage" as complete
- Added `ImageStorageManager` for disk-backed clipboard image storage
- Implemented save/load/delete + total storage bytes API
- Added unit tests for image storage manager
- Marked PRD item "Create image storage manager for clipboard images" as complete
- Added `ClipboardMonitor` (Combine publisher) with injectable pasteboard/workspace + timer-driven polling
- Implemented content extraction for text, RTF, image (TIFF data), and file URLs
- Added unit tests with mock pasteboard and controlled tick publisher
- Marked PRD item "Implement clipboard monitoring service" as complete

- Added EmailDetector (regex-based) in PastaDetectors with tests
- Marked PRD item "Build email address detector" as complete
- Added JWTDetector (base64url decode + claim extraction + expiry) in PastaDetectors with tests
- Marked PRD item "Build JWT token detector" as complete
- Added EnvVarDetector (.env/export parsing, block vs single) in PastaDetectors with tests
- Marked PRD item "Build environment variable detector" as complete
- Added URLDetector (http/https/ftp) with domain categorization and URL-encoded input handling
- Added unit tests for URLDetector including dedupe and percent-encoded URL parsing
- Marked PRD item "Build URL detector with site categorization" as complete
- Added FilePathDetector (Unix + Windows path detection, tilde expansion, existence checks)
- Added unit tests for FilePathDetector (including real temp file existence)
- Marked PRD item "Build file path detector" as complete
- Added CodeDetector (language identification heuristics + fenced-code-block support) in PastaDetectors with tests
- Marked PRD item "Build code snippet detector with language identification" as complete

- Added ProseDetector (prose vs code/structured heuristics, word count + reading time) in PastaDetectors with tests
- Marked PRD item "Build prose/natural text detector" as complete
- Added EncodingDetector (base64 + URL-percent decoding, nested decoding, preview metadata JSON) in PastaDetectors with tests
- Marked PRD item "Build base64 and URL encoding decoder" as complete

- Added ContentTypeDetector (unified pipeline) orchestrating detectors with priority selection
- Aggregated detector outputs into a single JSON metadata blob (JWT/email/env/url/path/code/prose + encoding)
- Implemented env-var block splitting into per-var split entries
- Added integration-style unit tests for ContentTypeDetector
- Marked PRD item "Create unified content type detection pipeline" as complete

- Implemented deduplication on DatabaseManager.insert via contentHash; duplicates now increment copyCount and refresh timestamp
- Added ClipboardEntry.contentHash (SHA256) helper
- Added unit test covering dedupe behavior
- Marked PRD item "Implement deduplication with copy count tracking" as complete
- Implemented FTS5-backed exact search (virtual table + triggers + rebuild migration)
- Implemented fuzzy search using Fuse with match ranges
- Added PastaCore SearchService with fuzzy/exact mode and optional content type filter
- Added unit tests for SearchService (exact, fuzzy, and content type filtering)
- Marked PRD item "Implement full-text search with fuzzy matching toggle" as complete

- Added PastaCore `DeleteService` to delete a single entry and clean up any associated image file
- Added DatabaseManager.fetch(id:) helper for DeleteService
- Added unit test covering delete + image cleanup
- Marked PRD item "Implement delete single entry" as complete

- Added DatabaseManager.deleteRecent(minutes:now:) for time-based deletion (returns deleted count + image paths)
- Extended DeleteService with deleteRecent(minutes:now:) to clean up associated image files
- Added unit tests for time-based deletion and image cleanup
- Marked PRD item "Implement delete entries for last X minutes" as complete
