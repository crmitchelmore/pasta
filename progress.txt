# Pasta - Clipboard History Progress Log

## Project Started
Date: 2026-01-19

---

## 2026-01-19
- Implemented core `ClipboardEntry` model (with `ContentType` + `CodeLanguage`) in PastaCore
- Added Codable round-trip unit test for `ClipboardEntry`
- Marked PRD item "Create core data model for clipboard entries" as complete
- Added `DatabaseManager` (GRDB) with migrations + CRUD/search APIs
- Added in-memory database factory for tests
- Added unit tests for DatabaseManager CRUD and ordering
- Marked PRD item "Set up SQLite database with GRDB for local storage" as complete
- Added `ImageStorageManager` for disk-backed clipboard image storage
- Implemented save/load/delete + total storage bytes API
- Added unit tests for image storage manager
- Marked PRD item "Create image storage manager for clipboard images" as complete
- Added `ClipboardMonitor` (Combine publisher) with injectable pasteboard/workspace + timer-driven polling
- Implemented content extraction for text, RTF, image (TIFF data), and file URLs
- Added unit tests with mock pasteboard and controlled tick publisher
- Marked PRD item "Implement clipboard monitoring service" as complete

- Added EmailDetector (regex-based) in PastaDetectors with tests
- Marked PRD item "Build email address detector" as complete
- Added JWTDetector (base64url decode + claim extraction + expiry) in PastaDetectors with tests
- Marked PRD item "Build JWT token detector" as complete
- Added EnvVarDetector (.env/export parsing, block vs single) in PastaDetectors with tests
- Marked PRD item "Build environment variable detector" as complete
- Added URLDetector (http/https/ftp) with domain categorization and URL-encoded input handling
- Added unit tests for URLDetector including dedupe and percent-encoded URL parsing
- Marked PRD item "Build URL detector with site categorization" as complete
- Added FilePathDetector (Unix + Windows path detection, tilde expansion, existence checks)
- Added unit tests for FilePathDetector (including real temp file existence)
- Marked PRD item "Build file path detector" as complete
- Added CodeDetector (language identification heuristics + fenced-code-block support) in PastaDetectors with tests
- Marked PRD item "Build code snippet detector with language identification" as complete

- Added ProseDetector (prose vs code/structured heuristics, word count + reading time) in PastaDetectors with tests
- Marked PRD item "Build prose/natural text detector" as complete
- Added EncodingDetector (base64 + URL-percent decoding, nested decoding, preview metadata JSON) in PastaDetectors with tests
- Marked PRD item "Build base64 and URL encoding decoder" as complete

- Added ContentTypeDetector (unified pipeline) orchestrating detectors with priority selection
- Aggregated detector outputs into a single JSON metadata blob (JWT/email/env/url/path/code/prose + encoding)
- Implemented env-var block splitting into per-var split entries
- Added integration-style unit tests for ContentTypeDetector
- Marked PRD item "Create unified content type detection pipeline" as complete

- Implemented deduplication on DatabaseManager.insert via contentHash; duplicates now increment copyCount and refresh timestamp
- Added ClipboardEntry.contentHash (SHA256) helper
- Added unit test covering dedupe behavior
- Marked PRD item "Implement deduplication with copy count tracking" as complete
- Implemented FTS5-backed exact search (virtual table + triggers + rebuild migration)
- Implemented fuzzy search using Fuse with match ranges
- Added PastaCore SearchService with fuzzy/exact mode and optional content type filter
- Added unit tests for SearchService (exact, fuzzy, and content type filtering)
- Marked PRD item "Implement full-text search with fuzzy matching toggle" as complete

- Added PastaCore `DeleteService` to delete a single entry and clean up any associated image file
- Added DatabaseManager.fetch(id:) helper for DeleteService
- Added unit test covering delete + image cleanup
- Marked PRD item "Implement delete single entry" as complete

- Added DatabaseManager.deleteRecent(minutes:now:) for time-based deletion (returns deleted count + image paths)
- Extended DeleteService with deleteRecent(minutes:now:) to clean up associated image files
- Added unit tests for time-based deletion and image cleanup
- Marked PRD item "Implement delete entries for last X minutes" as complete

- Added PastaCore HotkeyManager (HotKey-based) registering Control+Command+C and executing an onTrigger closure
- Wired PastaAppMain to initialize HotkeyManager and keep it alive for app lifetime
- Added unit test verifying hotkey registration (key/modifiers) and trigger callback
- Marked PRD item "Implement global hotkey (Control+Command+C)" as complete

- Implemented SwiftUI menu bar app entry point using MenuBarExtra (window-style popover)
- Configured app as menu-bar-only (no Dock icon) and hooked hotkey to activate the app
- Reused existing menu bar icon asset (MenuBarIcon)
- Marked PRD item "Create main app window with menu bar presence" as complete

- Implemented PastaUI `ClipboardListView` (LazyVStack-based) showing reverse-chronological entries with type icon/badge, relative timestamp, copy count, and large-entry indicator
- Wired the list into the menu bar popover as a basic history view (with a manual Refresh)
- Marked PRD item "Create clipboard history list view" as complete
- Added PastaUI `PreviewPanelView` showing full content, decoded preview (encoding detector), pretty-printed metadata JSON, and JWT header/payload/claims panels
- Rendered images inline from `imagePath`
- Added lightweight regex-based syntax highlighting for code entries
- Wired list selection -> preview panel in the menu bar popover
- Marked PRD item "Create entry preview panel" as complete

- Implemented keyboard navigation in the menu bar popover (↑/↓ selection, Enter paste, 1-9 quick paste, Esc close, Tab focus, Cmd+Backspace delete)
- Marked PRD item "Implement keyboard navigation" as complete


- Added PastaUI `FilterSidebarView` showing content-type counts with an All option
- Wired sidebar into menu bar popover; selecting URL type enables domain sub-filtering
- Verified filtering works with and without search
- Marked PRD item "Create content type filter sidebar" as complete

- Added UI delete confirmation dialogs: `DeleteConfirmationView` (single entry) and `BulkDeleteView` (delete last X minutes)
- Wired delete flows into the menu bar popover (toolbar buttons + Cmd+Backspace now prompts)
- Marked PRD item "Create delete confirmation dialogs" as complete

- Added PastaUI `SettingsView` and wired it into the app Settings scene
- Added UserDefaults-backed preferences: hotkey key/modifiers, launch-at-login toggle (UI-only), max entries (UI-only), excluded apps list
- Hotkey now reloads automatically when preferences change
- Added DatabaseManager/DeleteService "delete all" APIs and tests to support "Clear all history"
- Marked PRD item "Create settings/preferences view" as complete

- Added PastaCore PasteService (pasteboard write + Cmd+V simulation) with test doubles
- Wired PastaApp paste action to use PasteService
- Added unit tests for PasteService (text, file URLs, image TIFF, missing image data)
- Marked PRD item "Implement paste action (copy to clipboard and trigger paste)" as complete

- Added PastaUI `OnboardingView` (welcome → accessibility instructions → completion)
- Added PastaCore `AccessibilityPermission` helper to check/prompt Accessibility trust
- Wired onboarding to present on first launch and if permissions are revoked
- Ran `swift build` + `swift test`
- Marked PRD item "Create onboarding flow for permissions" as complete

- Added PastaUI `PastaTheme` with a warm palette (gold/tomato/basil) and app-wide accent tint
- Updated content-type tint colors to use the PastaTheme palette for a more cohesive UI
- Verified AppIcon + MenuBarIcon assets in Assets.xcassets
- Ran `swift build` + `swift test`
- Marked PRD item "Design and implement app icon and visual theme" as complete

- Implemented launch-at-login using ServiceManagement `SMAppService.mainApp` (register/unregister)
- Wired Settings toggle to apply immediately and reflect actual Login Item status on open
- Added PastaCore `LaunchAtLoginManager` wrapper + unit tests
- Ran `swift build` + `swift test`
- Marked PRD item "Implement launch at login" as complete

- Added PastaCore `ExclusionManager` (UserDefaults-backed) for excluded bundle IDs
- Wired ClipboardMonitor to skip emitting entries when source app is excluded
- Added unit tests for ExclusionManager parsing and clipboard exclusion behavior
- Ran `swift test`
- Marked PRD item "Implement app exclusion list" as complete

- Wired ClipboardMonitor → ContentTypeDetector/ImageStorageManager → DatabaseManager via new `AppViewModel`
- Popover UI now binds to `AppViewModel.entries` and auto-refreshes when the clipboard changes
- Images are persisted to disk and stored as `imagePath` (raw image data not stored in DB)
- Ran `swift build` + `swift test`
- Marked PRD item "Wire up all components in main app" as complete
