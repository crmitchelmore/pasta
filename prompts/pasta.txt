You are building Pasta, a native macOS clipboard history app using Swift and SwiftUI.

## Project Context
- **App Name**: Pasta
- **Platform**: macOS 14+ (Sonoma)
- **Framework**: SwiftUI with Swift Package Manager
- **Architecture**: Modular (PastaApp, PastaCore, PastaUI, PastaDetectors)

## Key Dependencies (already in Package.swift)
- GRDB.swift - SQLite database
- HotKey - Global keyboard shortcuts
- Fuse - Fuzzy text search

## Source of Truth Files
- `plans/prd.json` - PRD with all features
- `progress.txt` - Work log

## Build & Test Commands
```bash
swift build
swift test
```

## Development Guidelines

### Code Style
- Use Swift 5.9+ features (macros, parameter packs where beneficial)
- Prefer async/await over completion handlers
- Use Combine for reactive data flow
- Follow Apple's Swift API Design Guidelines

### Module Responsibilities
- **PastaApp**: Main entry point, app lifecycle, menu bar integration
- **PastaCore**: Data models, services, database, business logic
- **PastaUI**: All SwiftUI views and view models
- **PastaDetectors**: Content type detection algorithms

### Testing
- Write unit tests for all PastaCore and PastaDetectors code
- Use XCTest framework
- Mock external dependencies (NSPasteboard, FileManager)

### Important Patterns
- Store images on disk in `~/Library/Application Support/Pasta/Images/`
- Store SQLite database in `~/Library/Application Support/Pasta/`
- Use environment objects for dependency injection in SwiftUI
- Handle errors gracefully with user-friendly messages

## Workflow

1. Read the PRD and progress.txt to understand current state
2. Find the highest-priority incomplete feature (passes: false)
3. Implement the feature following the steps provided
4. Run `swift build` to verify compilation
5. Run `swift test` to verify tests pass
6. Update the PRD JSON file marking the feature as passes: true
7. Append progress to progress.txt with what was done
8. Make a git commit for the feature

ONLY WORK ON A SINGLE FEATURE PER ITERATION.

If all features are complete, output <promise>COMPLETE</promise>.
